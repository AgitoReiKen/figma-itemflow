(()=>{"use strict";var n={154:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.DisableFlowUpdate=t.EnableFlowUpdate=t.DisableFlowEvents=t.EnableFlowEvents=t.CreateFlow=t.Disable=t.Enable=t.GetPluginFrame=t.FlowWorker=t.flowSettings=t.FlowSettings=void 0;const r=n(522),p=o(n(634)),m=o(n(464)),s="ItemFrame",l="IF",f="IFC",a="IFS",i=s,c="undefined",v=new m.default(-99999,-99999);let u=c;function d(){let e;if(u!==c){var t=figma.currentPage.children.length;if(1<t){t=figma.currentPage.children[t-1];if(t.id===u)return e=t,e}e=figma.currentPage.findOne(e=>e.id===u)}if((null==e||void 0===e)&&(e=figma.currentPage.findOne(e=>"1"===e.getPluginData(i)),null==e||void 0===e)){const n=figma.createFrame();n.locked=!0,n.setPluginData(i,"1"),e=figma.currentPage.findOne(e=>"1"===e.getPluginData(i)),g()}return u=e.id,e}function g(){const e=d();figma.currentPage.insertChild(figma.currentPage.children.length,e),e.resize(1,1),e.x=v.x,e.y=v.y,e.name=s,e.clipsContent=!1}t.GetPluginFrame=d;class h{constructor(e,t,n,o){console.assert(e<=1&&t<=1&&n<=1&&o<=1),this.r=e,this.g=t,this.b=n,this.a=o}}class y{constructor(){this.strokeCap=["NONE","ARROW_EQUILATERAL"],this.dashPattern=[],this.weight=1,this.color=new h(0,0,0,1),this.bezier=!0}}t.FlowSettings=y;t.FlowWorker=class{constructor(){var e=new Blob([document.getElementById("itemflow-worker").textContent]);this.worker=new Worker(window.URL.createObjectURL(e)),this.worker.addEventListener("message",this.onMessageFromWorker.bind(this),null)}onMessageFromWorker(e){}terminate(){this.worker.terminate()}};const w=new y;t.flowSettings=w;class b{constructor(){this.nodesAbsoluteTransform=[]}}function k(e){e=e.getPluginData(a);return 0===e.length?null:JSON.parse(e)}function I(e){e=e.getPluginData(l);return 0===e.length?[]:JSON.parse(e)}function E(n){const e=d().findChildren(e=>{const t=I(e);return 2===t.length&&void 0!==t.find(e=>e===n.id)});e.forEach(e=>e.remove())}function M(){return d().findChildren(e=>2===I(e).length)}function A(e){var t=k(e);!function(e,t,n){const o=JSON.parse(JSON.stringify(e.vectorNetwork));"strokeCap"in o.vertices[o.vertices.length-1]&&(o.vertices[o.vertices.length-1].strokeCap=t,o.vertices[0].strokeCap=n),e.vectorNetwork=o}(e,t.strokeCap[0],t.strokeCap[1]),e.dashPattern=t.dashPattern,e.strokeWeight=t.weight;const n=JSON.parse(JSON.stringify(e.strokes));n[0].color.r=t.color.r,n[0].color.g=t.color.g,n[0].color.b=t.color.b,n[0].opacity=t.color.a,e.strokes=n}function S(e,t,n,o){var r=t.absoluteTransform,s=n.absoluteTransform,i=new m.default(r[0][2],r[1][2]),l=new m.default(s[0][2],s[1][2]),a=0===(u=(u=e).getPluginData(f)).length?null:JSON.parse(u);let c=!0;if(null!==a&&(c=a.nodesAbsoluteTransform[0].x!==i.x||a.nodesAbsoluteTransform[0].y!==i.y||a.nodesAbsoluteTransform[1].x!==l.x||a.nodesAbsoluteTransform[1].y!==l.y),o||c){var r=p.default.GetClosestSnapPoints(t,n),s=r[0].x-r[1].x,u=r[0].y-r[1].y,a=r[0].x-s-v.x,o=r[0].y-u-v.y;if(e.x=a,e.y=o,k(e).bezier){const g=[0,0],h=[0,0];a=.5*u,o=.5*s;"right"!==r[0]._type&&"left"!==r[0]._type||(g[1]=o,h[1]=u),"top"!==r[0]._type&&"bottom"!==r[0]._type||(g[1]=s,h[1]=a),"right"!==r[1]._type&&"left"!==r[1]._type||(g[0]=o,h[0]=0),"top"!==r[1]._type&&"bottom"!==r[1]._type||(g[0]=0,h[0]=a),e.vectorPaths=[{windingRule:"EVENODD",data:`M 0 0 C ${g[0]} ${h[0]} ${g[1]} ${h[1]} ${s} ${u}`}]}else e.vectorPaths=[{windingRule:"EVENODD",data:`M 0 0 L ${s} ${u}`}];A(e);const d=new b;d.nodesAbsoluteTransform=[i,l],l=d,e.setPluginData(f,JSON.stringify(l)),e.name=`${t.name} -> ${n.name}`}}function x(e,t=!1){var n,o=I(e),r=figma.getNodeById(o[0]),s=figma.getNodeById(o[1]);null===r||null===s?e.remove():(n=r.removed,o=s.removed,n&&E(r),o&&E(s),o||n||S(e,r,s,t))}function B(e,t,n){let o=null;var r,s,i;o=(r=e,s=t,figma.currentPage.findOne(e=>{e=I(e);return 2===e.length&&(e[0]===r.id&&e[1]===s.id)})),null===o&&(o=figma.createVector(),d().appendChild(o)),i=o,n=n,i.setPluginData(a,JSON.stringify(n)),n=o,t=[e.id,t.id],n.setPluginData(l,JSON.stringify(t)),x(o,!0)}t.CreateFlow=B;let N=-1,O=-1,C=-1,P=!1,_=!1;const T=100,F=1e3/30;function $(e=50,t=!1){e<2*F&&(e=2*F),(t||_)&&(-1!==N&&clearInterval(N),N=setInterval(()=>{if(_){const r=M();if(0<r.length)for(let o=0;o<=r.length/T;o++)setTimeout(()=>{let e=o*T,t=e+T;e>=r.length&&(e=r.length-1),t>r.length&&(t=r.length);const n=r.slice(e,t);n.forEach(e=>{x(e)})},o*F)}},e))}function D(){P=!0,(0,r.SetOnSelectionChanged)(e=>{2===e.length&&B(e[0],e[1],w)}),(0,r.SetOnSelectionItemAdded)(e=>{e.id===d().id&&(figma.currentPage.selection=[])}),(0,r.SetOnSelectionItemRemoved)(e=>{null!==e&&e.removed&&E(e)})}function L(){(P=!1,r.SetOnSelectionChanged)(e=>{}),(0,r.SetOnSelectionItemAdded)(e=>{}),(0,r.SetOnSelectionItemRemoved)(e=>{})}function R(){_=!0,function(){const e=()=>{var e=M()["length"];return e+e/T*F};$(e(),!0),C=setInterval(()=>{_&&$(e())},1e4)}()}function U(){_=!1,-1!==C&&(clearInterval(C),C=-1),-1!==N&&(clearInterval(N),N=-1)}t.EnableFlowEvents=D,t.DisableFlowEvents=L,t.EnableFlowUpdate=R,t.DisableFlowUpdate=U,t.Enable=function(){O=setInterval(()=>{P&&g()},1e3),D(),R()},t.Disable=function(){void 0!==n.g.flowWorker&&n.g.flowWorker.terminate(),-1!==O&&(clearInterval(O),O=-1),L(),U()}},522:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateSelection=t.GetSelection=t.SetOnSelectionItemRemoved=t.SetOnSelectionItemAdded=t.SetOnSelectionChanged=void 0;let r=[],n,s,i;function o(){const t=figma.currentPage["selection"];var e=r.length;const o=[];r.length>t.length?(r.forEach((n,e)=>{void 0!==t.find((e,t)=>n.id===e.id)&&o.push(n)}),o.forEach(e=>{s(e)}),r=o):r.length<t.length?t.forEach((n,e)=>{void 0!==r.find((e,t)=>n.id===e.id)||(r.push(n),i(n))}):t.length===r.length&&1===t.length&&t[0].id!==r[0].id&&(o.push(t[0]),i(t[0]),s(r[0]),r=o),1===e&&2===r.length&&n(r)}t.UpdateSelection=o,t.GetSelection=function(){return r},t.SetOnSelectionItemRemoved=function(e){s=e},t.SetOnSelectionItemAdded=function(e){i=e},t.SetOnSelectionChanged=function(e){n=e,figma.on("selectionchange",()=>{o()})}},634:function(e,t,n){var o=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});class l extends o(n(464)).default{constructor(e,t,n){super(e,t),this._type=n}}function r(e,t){const n=new l(0,0,t);var o=e.rotation*(3.14/180),r=e.absoluteTransform[0][2],s=e.absoluteTransform[1][2];return"top"===t&&(n.x=r+.5*e.width*Math.cos(o),n.y=s-.5*e.width*Math.sin(o)),"right"===t&&(n.x=r+e.width*Math.cos(o)+.5*e.height*Math.sin(o),n.y=s+.5*e.height*Math.cos(o)-e.width*Math.sin(o)),"bottom"===t&&(n.x=r+.5*e.width*Math.cos(o)+e.height*Math.sin(o),n.y=s+e.height*Math.cos(o)-.5*e.width*Math.sin(o)),"left"===t&&(n.x=r+.5*e.height*Math.sin(o),n.y=s+.5*e.height*Math.cos(o)),n}function u(e){const t=[];var n=e.rotation*(3.14/180),o=e.absoluteTransform[0][2],r=e.absoluteTransform[1][2],s=Math.cos(n),i=Math.sin(n),{height:n,width:e}=e;return t.push(new l(o+.5*e*s,r-.5*e*i,"top")),t.push(new l(o+e*s+.5*n*i,r+.5*n*s-e*i,"right")),t.push(new l(o+.5*e*s+n*i,r+n*s-.5*e*i,"bottom")),t.push(new l(o+.5*n*i,r+.5*n*s,"left")),t}t.default={GetSnapPoint:r,GetSnapPointById:function(e,t){return r(e,0===t?"top":1===t?"right":2===t?"bottom":"left")},GetClosestSnapPoints:function(e,t){var n=u(e),o=[n[1],n[3]],r=[n[0],n[2]],s=u(t),i=[s[1],s[3]],e=[s[0],s[2]];const l=(n=function(t,n){const o=[null,null];let r=99999999;for(let e=0;e<2;e++){var s=(e+1)%2,i=t[e].dist(n[s]);i<r&&(o[0]=t[e],o[1]=n[s],r=i)}return[r,o]})(o,i);t=Math.abs(l[1][0].x-l[1][1].x),s=Math.abs(l[1][0].y-l[1][1].y),o=l[1][0].dist(l[1][1]);const a=n(r,e);i=Math.abs(a[1][0].x-a[1][1].x),n=Math.abs(a[1][0].y-a[1][1].y),r=a[1][0].dist(a[1][1]),Math.abs(a[1][0].x-l[1][1].x),Math.abs(a[1][0].y-l[1][1].y),e=a[1][0].dist(l[1][1]);let c=9999999;if(o<c&&(c=o),r<c&&(c=r),e<c&&(c=e),s<1.5*t){s=l[1][0],t=l[1][1];if("right"===s._type?s.x<t.x:s.x>t.x)return[l[1][0],l[1][1]]}return i<2*n?[a[1][0],a[1][1]]:[l[1][0],a[1][1]]}}},464:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0});t.default=class{constructor(e,t){this.x=e,this.y=t}dist(e){var t=this.x-e.x,e=this.y-e.y;return Math.sqrt(t*t+e*e)}}}},o={};function r(e){var t=o[e];if(void 0!==t)return t.exports;t=o[e]={exports:{}};return n[e].call(t.exports,t,t.exports,r),t.exports}r.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();(()=>{const n=r(154);window.onmessage=e=>{var{}=e;console.log(e.data)};let o;window.onload=()=>{const r=`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="2" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="4"></line>
            </svg>
        `,s=`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M22 12L14 18L14 6L22 12Z" fill="currentColor"></path>
            <line x1="14" y1="12" x2="2" y2="12" stroke="currentColor" stroke-width="4"></line>
            </svg>
        `,e=document.getElementById("strokecap0-switch"),t=document.getElementById("strokecap1-switch");e.setAttribute("capType","NONE"),e.innerHTML=r,t.setAttribute("capType","ARROW_EQUILATERAL"),t.innerHTML=s,e.onclick=()=>{const e=[{id:"NONE",icon:r},{id:"ARROW_EQUILATERAL",icon:`
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M2 12L10 6V18L2 12Z" fill="currentColor"></path>
            <line x1="10" y1="12" x2="22" y2="12" stroke="currentColor" stroke-width="4"></line>
            </svg>
        `}],t=document.getElementById("strokecap0-switch"),n=t.getAttribute("capType");var o=e.findIndex(e=>e.id===n),o=o+1>=e.length?0:o+1;t.setAttribute("capType",e[o].id),t.innerHTML=e[o].icon;o=[e[o].id,null];parent.postMessage({pluginMessage:{type:"set-stroke-cap",value:o}},"*")},t.onclick=()=>{const e=[{id:"NONE",icon:r},{id:"ARROW_EQUILATERAL",icon:s}],t=document.getElementById("strokecap1-switch"),n=t.getAttribute("capType");var o=e.findIndex(e=>e.id===n),o=o+1>=e.length?0:o+1;t.setAttribute("capType",e[o].id),t.innerHTML=e[o].icon;o=[null,e[o].id];parent.postMessage({pluginMessage:{type:"set-stroke-cap",value:o}},"*")},document.getElementById("bezier-switch").setAttribute("checked","true"),document.getElementById("bezier-switch").onclick=()=>{const e=document.getElementById("bezier-switch");var t=e.hasAttribute("checked");t?e.removeAttribute("checked"):e.setAttribute("checked","true"),parent.postMessage({pluginMessage:{type:"set-bezier",value:!t}},"*")},document.getElementById("enable-switch").setAttribute("checked","true"),document.getElementById("enable-switch").onclick=()=>{const e=document.getElementById("enable-switch");var t=e.hasAttribute("checked");t?e.removeAttribute("checked"):e.setAttribute("checked","true"),parent.postMessage({pluginMessage:{type:"set-enabled",value:!t}},"*")},document.getElementById("update-switch").setAttribute("checked","true"),document.getElementById("update-switch").onclick=()=>{const e=document.getElementById("update-switch");var t=e.hasAttribute("checked");t?e.removeAttribute("checked"):e.setAttribute("checked","true"),parent.postMessage({pluginMessage:{type:"set-update",value:!t}},"*")},document.getElementById("lock-switch").setAttribute("checked","true"),document.getElementById("lock-switch").onclick=()=>{const e=document.getElementById("lock-switch");var t=e.hasAttribute("checked");t?e.removeAttribute("checked"):e.setAttribute("checked","true"),parent.postMessage({pluginMessage:{type:"set-framelocked",value:!t}},"*")};for(let s=1;s<6;s++)document.getElementById(`stroke-color-${s}`).onclick=()=>{const o=document.getElementById(`stroke-color-${s}`),r=o.getAttribute("color");!function(){for(let e=1;e<6;e++){const n=document.getElementById(`stroke-color-${s}`);var t=n.getAttribute("color");r!==t&&o.removeAttribute("checked")}}(),o.setAttribute("checked","true"),document.getElementById("stroke-color-hex").value=r,document.getElementById("stroke-color").value=r,parent.postMessage({pluginMessage:{type:"set-color",value:r}},"*")};document.getElementById("stroke-opacity").onchange=()=>{const e=document.getElementById("stroke-opacity");var t=e.value.replace("%","");let n=0;n=parseFloat(t),isNaN(n)?(n=100,e.value="100%"):(100<n&&(n=100),n<0&&(n=0),e.value=`${n.toFixed(0)}%`),parent.postMessage({pluginMessage:{type:"set-color-opacity",value:n/100}},"*")},document.getElementById("stroke-color").onchange=()=>{var t=document.getElementById("stroke-color")["value"];for(let e=1;e<6;e++){const n=document.getElementById(`stroke-color-${e}`);t===n.getAttribute("color")?n.setAttribute("checked","true"):n.removeAttribute("checked")}document.getElementById("stroke-color-hex").value=t,parent.postMessage({pluginMessage:{type:"set-color",value:t}},"*")},document.getElementById("stroke-color-hex").onchange=()=>{const e=document.getElementById("stroke-color-hex");e.value=function(e){function t(e,t,n=2){return parseInt(t.substr(e,n),16)}if(2===(e=!e.startsWith("#")?`#${e}`:e).length){const o=parseInt(e.substr(1,1),16);if(!isNaN(o)){let t="#";var n=o.toString(16).toUpperCase();for(let e=0;e<6;e++)t+=n;return t}}if(3===e.length){const r=t(1,e);if(!isNaN(r)){let e=r.toString(16).toUpperCase();return 1===e.length&&(e+="0"),`#${e}${e}${e}`}}if(4===e.length){const s=t(1,e),i=t(3,e,1);if(!isNaN(s)&&!isNaN(i)){let e=s.toString(16).toUpperCase(),t=i.toString(16).toUpperCase();return 1===e.length&&(e+="0"),1===t.length&&(t+="0"),`#${e}${t}${t}`}}else if(5===e.length){const l=t(1,e),a=t(3,e);if(!isNaN(l)&&!isNaN(a)){let e=l.toString(16).toUpperCase();1===e.length&&(e+="0");let t=a.toString(16).toUpperCase();return 1===t.length&&(t+="0"),`#${e}${t}00`}}else if(6<=e.length){const c=t(1,e),u=t(3,e),d=t(5,e);if(!isNaN(c)&&!isNaN(u)&&!isNaN(d)){let e=c.toString(16).toUpperCase();1===e.length&&(e+="0");let t=u.toString(16).toUpperCase();1===t.length&&(t+="0");let n=d.toString(16).toUpperCase();return 1===n.length&&(n+="0"),`#${e}${t}${n}`}}return"#000000"}(e.value);const t=document.getElementById("stroke-color");t.value!==e.value&&(t.value=e.value),parent.postMessage({pluginMessage:{type:"set-color",value:e.value}},"*")},document.getElementById("stroke-weight").onchange=()=>{const e=document.getElementById("stroke-weight");0===e.value.length&&(e.value="1"),parent.postMessage({pluginMessage:{type:"set-stroke-weight",value:parseInt(e.value,10)}},"*")},document.getElementById("dash-pattern").onchange=()=>{const e=document.getElementById("dash-pattern");0===e.value.length&&(e.value="0"),parent.postMessage({pluginMessage:{type:"set-dash-pattern",value:parseInt(e.value,10)}},"*")},document.getElementById("dash-pattern-switch").onclick=()=>{const e=document.getElementById("dash-pattern-switch"),t=document.getElementById("dash-pattern");var n;e.hasAttribute("value")?(n=e.getAttribute("value"),"0"===t.value?t.value=n:(t.value===n||e.setAttribute("value",t.value),t.value="0")):"0"!==t.value&&(e.setAttribute("value",t.value),t.value="0"),parent.postMessage({pluginMessage:{type:"set-dash-pattern",value:parseInt(t.value,10)}},"*")},document.getElementById("github-link").onclick=()=>{window.open("https://github.com/AgitoReiKen/figma-itemflow")},o=new n.FlowWorker,parent.postMessage({pluginMessage:{type:"init"}},"*")}})()})();